---
title: "R, RStudio y forma de trabajar (WIP)"
author: "Pedro J. P√©rez"
date: "`r format(Sys.time(), '%d %B %Y')`"
#date: "2020/03/05 (updated: `r Sys.Date()`)"
output:
  html_document:
    css: !expr here::here("assets", "styles_pjp.css") #-https://stackoverflow.com/questions/56681879/how-to-use-here-for-paths-to-css-before-body-and-after-bod
    theme: paper
    highlight: textmate 
    toc: true
    toc_depth: 3 
    toc_float: 
      collapsed: true
      smooth_scroll: true
    self_contained: true
    number_sections: false
    #code_folding: show
    df_print: kable
    code_download: true
editor_options: 
  chunk_output_type: console
bibliography: "`r here::here('assets', 'biblio.bib')`"  #- joooder. single quotes https://community.rstudio.com/t/use-here-here-function-in-yaml-option/18667/9
---





```{r chunk_setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, 
                      cache = FALSE, cache.path = "/caches/", comment = "#>",
                      #fig.width = 7, fig.height= 7,   
                      #out.width = 7, out.height = 7,
                      collapse = TRUE,  fig.show = "hold",
                      fig.asp = 7/9, out.width = "75%", fig.align = "center")
```

```{r options_setup, echo = FALSE}
options(scipen = 999) #- para quitar la notaci√≥n cient√≠fica
```

```{r, echo = FALSE}
library(knitr)
library(here)
```

El objetivo de esta secci√≥n es proporcionar una breve primera introducci√≥n a R y RStudio para personas que no han tenido contacto previo con estos programas y explicitar la forma que tendremos de interactuar con ellos; es decir, la forma de trabajar con ellos (*workflow*).

El curso es una introducci√≥n a la Ciencia de Datos: haremos diversos an√°lisis con datos y para ello utilizaremos R. R ser√° el programa que har√° los c√°lculos, gr√°ficos, informes, pero interactuaremos con R, le daremos las ordenes a R, a trav√©s de otro programa: RStudio. As√≠ que tendremos que instalar los 2 programas. Por ello, en el [repo del curso](https://github.com/perezp44/tutoriales_intro_DS) tienes un fichero donde se explica como hacerlo.

<br>

Se puede trabajar con R/RStudio de varias formas. Nosotros trabajaremos, casi siempre, con `Rprojects`. Enseguida diremos qu√© son los Rprojects, pero de momento podemos pensar que son carpetas donde se almacenan los ficheros necesarios para hacer un an√°lisis de datos.


Dentro de esas carpetas o `Rprojects` tendremos distintos tipos de ficheros: ficheros de datos, im√°genes etc... y unos ficheros, llamados habitualmente **scripts** que contendr√°n  las instrucciones que queramos que sean ejecutadas por R/RStudio. Bien, pues esos scripts o ficheros de ordenes pueden ser de varios tipos. Concretamente, durante el curso utilizaremos 2 tipos de ficheros para darle las ordenes a R:   

  - `ficheros .R` , y    
    
  - `ficheros Rmarkdown` o `ficheros .Rmd`. 
      
      
Lo normal es que nunca hayas o√≠do hablar de todo esto, as√≠ que al principio te sonar√° complicado, pero en nada te parecer√° lo m√°s natural del mundo. Bird by bird!!!



## 1. R

Ya hemos hablado de R, pero ...

### ¬øQu√© es R?

Ya lo hab√©is visto mientras hac√≠amos alg√∫n ejemplo, pero para los nuevos: R es un lenguaje de programaci√≥n y un entorno para el an√°lisis estad√≠stico y gr√°fico. Se puede utilizar para muchas cosas ya que es un lenguaje de programaci√≥n, pero principalmente se utiliza en el campo de la estad√≠stica y la ciencia de datos; de hecho, R fue inicialmente creado en 1993 por dos estad√≠sticos de la Universidad de Auckland: R. Ihaka y R.Gentleman^[[Aqu√≠](https://dl.acm.org/doi/abs/10.1145/3386334) tienes un art√≠culo con la historia de R]. A partir de 1997 el desarrollo de R (o **base-R**) es gestionado por un grupo de programadores conocido como "The R-core team"; pero actualmente, el entorno o ecosistema R es el resultado de la colaboraci√≥n de toda una comunidad de usuarios que extiende las utilidades de base-R mediante la creaci√≥n de nuevos paquetes y funciones.

R forma parte del sistema [GNU](https://es.wikipedia.org/wiki/GNU) y se distribuye bajo la licencia [GNU GPL](https://es.wikipedia.org/wiki/GNU_General_Public_License) por lo que los usuarios tenemos la libertad de usar, estudiar, compartir (copiar) y modificar el software; es decir, R es [**software libre**](https://www.gnu.org/philosophy/free-sw.es.html). Adem√°s de software libre, R es gratuito y multiplataforma: est√° disponible para Windows, Macintosh y GNU/Linux.  



La p√°gina web oficial de R se llama: [The R Project for Statistical Computing](https://www.r-project.org/). All√≠ podr√°s encontrar toda la informaci√≥n y documentaci√≥n oficial acerca de R. Aunque si alguna vez la necesitas, se puede consultar desde R con la funci√≥n `help.start()` o, en un formato visualmente m√°s agradable, en [este repositorio](https://colinfay.me/r-manuals/) de Collin Fay un destacado miembro de la actual comunidad R. Si quieres ver las personas que forman parte del R core-team o que han contribuido al desarrollo de R no tienes mas que teclear en R `contributors()`.


R proporciona un amplio abanico de herramientas estad√≠sticas y gr√°ficas (modelos lineales y no lineales, tests estad√≠sticos, an√°lisis de series temporales, algoritmos de clasificaci√≥n y agrupamiento, etc.). Como R tambi√©n es un lenguaje de programaci√≥n, permite que los usuarios lo extiendan definiendo sus propias funciones y paquetes. De hecho, actualmente R se ha convertido de un proyecto colaborativo y abierto en el que sus usuarios pueden publicar paquetes que extienden su configuraci√≥n b√°sica. Para darte una idea de lo prol√≠fica y colaborativa que es la comunidad R puedes visitar estos 2 proyectos: [R-bloggers](https://www.r-bloggers.com/) y [R-Weekly](https://rweekly.org/). Precisamente estos 2 aspectos (abundancia de paquetes y comunidad de usuarios) son claves en el √©xito de R


Ya hemos dicho que R (junto con sus paquetes) puede implementar una gran variedad de t√©cnicas estad√≠sticas y gr√°ficas. Existe un repositorio oficial de paquetes: Comprehensive R Archive Network o [CRAN](https://cran.r-project.org/). CRAN alcanz√≥ los [10.000 paquetes](https://blog.revolutionanalytics.com/2017/01/cran-10000.html) en enero de 2017, y actualmente, julio de 2019, tiene 14.553 paquetes. Adem√°s, existen muchos m√°s paquetes en repositorios como [Bioconductor](https://www.bioconductor.org/), [Github](https://github.com/) y otros.

<br>

### Instalaci√≥n de R 

Obviamente, para usar R y sus paquetes tenemos que instalarlo primero. Para ello "solo" tienes que ir a [CRAN](https://cran.r-project.org/) y descargar la distribuci√≥n de R adecuada para tu sistema operativo. Obviamente mejor la √∫ltima versi√≥n. En el momento de re-escribir estas notas la √∫ltima versi√≥n es `R-4.0.2` llamada  "Taking off again" released on 2020/06/22. Esta vez tengo R a la √∫ltima, actualice hace nada.  

No te va a a hacer falta pero por si acaso, [aqu√≠](https://jjallaire.shinyapps.io/learnr-tutorial-00-setup/#section-install-r) tienes un v√≠deo de 1:30 donde se explica de manera sencilla como instalar R, y [aqu√≠](https://github.com/pachamaltese/tutoriales/blob/master/2019-04-24-instalar-r.md) tienes una explicaci√≥n muy detallada del proceso de instalaci√≥n.


Como recomiendan [aqu√≠](https://teachdatascience.com/cloud/) el primer d√≠a de clase usaremos R a trav√©s de la plataforma [RStudio Cloud](https://rstudio.cloud/). Demoraremos los potenciales problemas que puedan surgir en la instalaci√≥n de R  al segundo o tercer d√≠a de clase^[De esto esta vez no estoy seguro porque en Agosto de 2020 RStudio Cloud comenzar√° a ser de pago. Veremos como queda la versi√≥n gratuita].



## 2. RStudio 

### ¬øQu√© es RStudio?

Pues es un programa que utilizaremos para interactuar con R. Las instrucciones que queramos dar a R para que las ejecute se las daremos a trav√©s de RStudio. La raz√≥n es que la interfaz de usuario (GUI, Graphical User Interface) de R no es muy amigable ni vers√°til, as√≠ que interactuaremos con R a trav√©s de RStudio.  

RStudio es un programa que nos permitir√° interactuar con R de forma m√°s amigable, adem√°s de facilitar muchas de las tareas de programaci√≥n y an√°lisis de datos en R; es decir, RStudio es una GUI (Graphical User Interface). En realidad, RStudio es m√°s que una GUI, es una IDE, un entorno de desarrollo integrado para R, en ingl√©s  *'integrated development environment'* o **IDE**.   

El actual cient√≠fico jefe de RStudio es [Hadley Wickham](http://hadley.nz/). Wickham es uno de los m√°s prol√≠ficos desarrollador de paquetes para R y creador de un nuevo estilo de programar y analizar datos en R conocido como *'[tidyverse](https://blog.rstudio.org/2016/09/15/tidyverse-1-0-0/)'*. Muchos de los packages que utilizaremos en el curso han sido desarrollados por √©l y el equipo de RStudio. 

<br>

### Instalaci√≥n de RStudio

La versi√≥n de escritorio de RStudio tambi√©n es libre y gratuita. Se puede descargar [aqu√≠](https://www.rstudio.com/products/rstudio/download/). Tienes que descargarte el *'installer'* adecuado para tu sistema operativo. 

Se puede trabajar perfectamente con las opciones por defecto de RStudio, pero os recomiendo cambiar algunas opciones, as√≠ que vamos a configurar RStudio.

### Configurando RStudio

Est√° secci√≥n no es obligatoria, solo que es recomendable configurar las opciones de RStudio. ¬øC√≥mo? En RStudio, sigue est√° ruta de men√∫s: `Tools > Global OPtions...` 


```{r, echo = FALSE, out.width = "75%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_06_RStudio-opciones.png") ) 
```


Se abrir√° una ventana (que puedes ver abajo) con las opciones de configuraci√≥n de RStudio. De momento vamos s√≥lo a tocar la categor√≠a que ves en la imagen; es decir, `R General`. Tienes que hacer dos cosas:

  1. desmarcar todas las casillas (quitarles los ticks) excepto la √∫ltima  
  
  2. Es importante, poner `Never` en la casilla donde pone "Save workspace to .RData on exit". 
  
Al final, en mi ordenador, la ventana con las opciones de `R General` queda como: 


```{r, echo = FALSE, out.width = "95%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_07_RStudio-opciones-2.png") ) 
```

En tu ordenador debe quedar todo igual excepto las dos primeras cajas de texto:

  - la primera caja que le dice a RStudio que versi√≥n de R ha de usar y donde est√° en tu ordenador. En mi caso, cuando estaba escribiendo estas notas, estaba usando la versi√≥n 3.5.3 de 64 bites de R, por eso en mi caja pone "[64-bit] C:\Program Files\R\R-3.5.3" que es la ruta donde ten√≠a yo R en mi ordenador.  Esta caja de texto no la has de cambiar, d√©jala tal y como la encuentres 

  - la segunda caja le dice a RStudio donde se guardar√°n los archivos que vayamos generando; es decir, indica el directorio de trabajo por defecto.  Como yo habitualmente trabajo en el escritorio de mi PC, en la imagen de abajo pone  "C:/Users/perezp/Desktop". Te recomiendo trabajar sobre el escritorio o Desktop, pero puedes seleccionar la carpeta en la que m√°s c√≥moda trabajes.




```{r, echo = FALSE, out.width = "50%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_07_RStudio-opciones-3.png") ) 
```

Ya explicar√© en clase porqu√© seleccionamos estas opciones en RStudio.


#### A√∫n m√°s configuraci√≥n de RStudio


1. En RStudio sigue est√° ruta de men√∫s: `Tools > Global OPtions...` y selecciona `Code`. Intenta dejar la opciones de la pesta√±a `Editing` como ves en la imagen de abajo. Concretamente lo que m√°s me interesa es que est√© marcada la opci√≥n `Insert spaces for tab`



```{r, echo = FALSE, out.width = "50%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_07_RStudio-opciones-4.png") ) 
```

2.  En RStudio sigue est√° ruta de men√∫s: `Tools > Global OPtions...` y selecciona `Code`. Ahora intenta dejar las opciones de la pesta√±a `Saving` como ves en la imagen de abajo. Lo m√°s importante es que en la caja de texto `Default text encoding` ponga: `UTF-8`


```{r, echo = FALSE, out.width = "50%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_07_RStudio-opciones-5.png") ) 
```

Ya tenemos R y RStudio instalados y configurados, as√≠ que vamos a empezar a toquetear RStudio.

### Conociendo la interfaz de RStudio

Durante el curso vamos a utilizar R para hacer an√°lisis estad√≠sticos pero lo vamos a hacer a trav√©s de RStudio, as√≠ que el primer paso es familiarizarnos un poco con la interfaz de RStudio. Para acostumbrase a R y RStudio lo mejor es la pr√°ctica, pero si os hiciese falta, [aqu√≠](https://ismayc.github.io/rbasics-book/index.html) ten√©is un fant√°stico libro para habituarse a trabajar con R y RStudio.


Al abrir RStudio ver√°s que al principio tiene 3 paneles, aunque enseguida abriremos un cuarto panel. La consola es el panel de la izquierda. Cuando tengamos 4 paneles la consola ser√° el panel situado izquierda-abajo. Podemos pensar que la consola es lo m√°s parecido a R, ya que en la consola se pueden ejecutar instrucciones de R directamente. 

Cuando abras RStudio veras lo siguiente:

```{r, echo = FALSE, out.width = "85%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_01_RStudio-inicial.jpg") ) 
```


- Consola (izquierda)  

- Environment/History (arriba-derecha)  

- Files/Plots/Packages/Help (abajo-derecha)  




Ya sabemos que el panel de la izquierda es la consola. En la consola se ve un mensaje de bienvenida que nos dice que versi√≥n de R estamos usando y alguna cosa m√°s. Al final del texto aparece el s√≠mbolo `>`. A este s√≠mbolo se le conoce como *prompt* y simplemente nos indica que el int√©rprete de R, que R, est√° listo para ejecutar nuestras instrucciones. 

¬øC√≥mo le damos las instrucciones u ordenes a R? La forma m√°s inmediata es escribiendo las ordenes en la consola, despu√©s del prompt (`>`). Por ejemplo, si escribimos en la consola `2+2` y presionamos  <kbd>Enter</kbd>, R ejecutar√° la instrucci√≥n y nos devolver√° el resultado. 

A veces usaremos la consola para ejecutar alguna instrucci√≥n, pero en general ejecutaremos las instrucciones a trav√©s de un "script". Una raz√≥n para no usar la consola es que trabajar en la consola es muy limitado ya que las instrucciones se han de introducir una a una. Otra raz√≥n es que queremos tener un registro con todas las instrucciones que ejecutemos para poder replicar nuestro an√°lisis en otro momento; as√≠ que lo habitual es trabajar con **scripts** o **ficheros de instrucciones**. 

Un script no es m√°s que un fichero de texto con extensi√≥n `.R` en el que escribiremos las instrucciones que queramos que R ejecute.

Vamos a crear nuestro primer script. Para ello tienes que seguir esta ruta de men√∫s en RStudio: `File > New File > R Script`. Visualmente: 


```{r, echo = FALSE, out.width = "80%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_02_RStudio-new-script.png") ) 
```


Cuando pinches con el rat√≥n en `R Script` se abrir√° en RStudio un nuevo panel, el cuarto, arriba a la izquierda. Visualmente:


```{r, echo = FALSE, out.width = "80%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_03_RStudio-new-script-1.png") )
```

Este cuarto panel (arriba-izquierda) en realidad es un editor de texto. En √©l podemos 
escribir las instrucciones que queramos que ejecute R. Por ejemplo, f√≠jate en la siguiente im√°gen lo que he escrito en el panel arriba-izquierda: 


```{r, echo = FALSE, out.width = "95%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_03x_RStudio-new-script-2.png")) 
```


He escrito estas cuatro lineas:


```{r, echo = TRUE, eval = FALSE}
# mi primer script de R
2 + 2
5 * 6
400/2
```


Escribe t√∫ tambi√©n (o copia y pega) est√°s cuatro lineas de texto en el editor (arriba-izquierda) de tu Rstudio.

R ejecutar√°, cuando se lo indiquemos, las lineas de instrucciones una a una.

Una vez hayas escrito o pegado esas 4 lineas en RStudio, ver√°s que la primera linea es diferente: lo m√°s evidente es que est√° en color verde, pero en realidad lo importante es que comienza con el s√≠mbolo `#`. Este hecho, est√° marcando/diciendo a R que esa linea es un comentario para los humanos, para nosotros, no es c√≥digo R y por tanto R no la ejecutar√°.


En un script s√≥lo se pueden escribir 2 cosas:

- comentarios (si la linea comienza con `#`). R no las ejecutar√°  

- instrucciones R (no comienzan con `#`). R las ejecutar√° si est√°n escritas en R; es decir, si siguen las reglas del lenguaje R. Si est√°n mal escritas R nos devolver√° un mensaje de error. Tenemos que aprender R ya!!!



Hemos escrito cuatro lineas en nuestro script y ahora queremos que R las ejecute. R ejecutar√°, cuando se lo indiquemos, las lineas de instrucciones una a una.


Para ejecutar una linea, situamos el cursor en ella y pulsamos <kbd>Crtl</kbd> + <kbd>Enter</kbd>.

Please, sit√∫a el cursor en la primera linea y pulsa <kbd>Crtl</kbd> + <kbd>Enter</kbd>. Observa qu√© ha ocurrido. Le hemos dicho a R que ejecute la primera linea, pero como esta primera linea comienza con `#`, R la ha interpretado (correctamente) como un comentario y, por supuesto, no la ha ejecutado, por lo que ha pasado a la segunda linea, y esta vez s√≠ que la ejecuta. Como la segunda linea no comienza con `#`, R la interpreta como una instrucci√≥n de R y, s√≠ la entiende (si las has escrito correctamente siguiendo la sintaxis o lenguaje de R), ejecutar√° la instrucci√≥n. R entiende que significa `2 + 2`, as√≠ que ejecuta la instrucci√≥n y nos devuelve el resultado en la consola.

<br>

En la imagen de abajo yo ya he ejecutado la instrucci√≥n `2 + 2`. R nos muestra el resultado en la consola: primero nos muestra, en azul, la instrucci√≥n que ha ejecutado; es decir `> 2 + 2` y luego nos nos muestra, en negro, el resultado de la ejecuci√≥n de la instrucci√≥n; es decir `[1] 4`. Ya veremos que significa el [1] de la linea de resultados.


```{r, echo = FALSE, out.width = "95%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_04_RStudio-new-script-2.png")) 
```

Es m√°s f√°cil hacerlo que contarlo, aunque puede que te atasques en alguna cosa, normal!!. Por ejemplo, si en lugar de poner el cursor en la segunda linea, se√±alas o subrayas solo parte de la linea, entonces, seguramente R no te entender√°. Ahora te toca a ti: please, ejecuta la tercera linea de tu script.

¬øC√≥mo le decimos a R que ejecute la tercera linea  `5 * 6`? Cuando lo hac√≠amos en la consola simplemente hab√≠a que pulsar <kbd>Enter</kbd>, pero ahora estamos trabajando en un script: hay que situar el cursor en la linea que queremos ejecutar y darle a <kbd>Crtl</kbd> + <kbd>Enter</kbd>. R ejecutar√° la instrucci√≥n y nos devolver√° el resultado en la consola. 


Enseguida aprenderemos m√°s instrucciones o funciones de R, ahora solo estamos intentando familiariz√°ndonos con el interface de RStudio. Ya sabemos como crear un fichero con instrucciones de R (√≥ script) y como ejecutar esas instrucciones. 

Lo normal es que guardes tus scripts en un archivo por si tuvieses que volver a correr las mismas instrucciones m√°s adelante. Para guardar tus instrucciones en un fichero s√≥lo tienes que seguir esta ruta de men√∫s en RStudio: `File > Save as ...`  

Tendr√°s que elegir un nombre para tu script y decidir en que carpeta de tu ordenador guardarlo. Si decides que tu script se llame `my_script_01`, se crear√° un fichero (donde t√∫ hayas decidido) llamado `my_script_01.R`. F√≠jate que la extensi√≥n del archivo es **`.R`**, est√° extensi√≥n identifica los scripts o ficheros con instrucciones de R.

Esto vas a acabar entendiendolo en poco tiempo, pero cuanto antes lo entiendas mejor: damos las ordenes/instrucciones a R por escrito, generalmente usamos "scripts"; es decir, escribimos las instrucciones en un fichero con extensi√≥n .R. Para ejecutar las ordenes que hemos escrito en nuestro fichero R hemos de, linea por linea, teclear: <kbd>Crtl</kbd> + <kbd>Enter</kbd>. Si la orden tiene sentido, es decir, si R entiende la orden, la ejecutar√° y te mostrar√° el resultado en la Consola.

<br>

Bien, ya sabemos hacer que R ejecute nuestras instrucciones: podemos ejecutar ordenes en la Consola (con <kbd>Enter</kbd>) o en un script (<kbd>Crtl</kbd> + <kbd>Enter</kbd>). Usaremos la consola a veces, muchas veces trabajaremos con scripts o ficheros .R pero, poco a poco, acabaremos trabajando de otra forma. 

Como queremos que nuestros an√°lisis sean reproducibles, habitualmente trabajaremos con `Rprojects` y con `ficheros .Rmd`. **S√≠!!**, en lugar de con `ficheros .R` (o scripts) trabajaremos con `ficheros  **Rmarkdown` √≥ `ficheros .Rmd`. Ya lo veremos, pero antes tendremos que familiarizarnos un poco m√°s con el lenguaje R. De momento seguimos con el interfaz de RStudio.

<br>

#### Los 4 paneles de RStudio

Vamos a mirar con un poco m√°s de detalle **los 4 paneles de RStudio**. Como puedes ver en la imagen de abajo, generalmente, a la izquierda encontramos la consola y el editor de scripts. Ya sabemos que desde estos dos paneles podemos dar instrucciones a R para que las ejecute.

Veamos un poco los 2 paneles de la derecha. Podemos pensar que son paneles auxiliares, nos ayudar√°n en determinadas tareas. Estos dos paneles de la derecha  tienen cada uno varias pesta√±as. Por ejemplo, el panel que est√° en la posici√≥n arriba-derecha tiene cuatro pesta√±as: `Environment` y 3 m√°s^[Igual en vuestro ordenador ten√©is m√°s (o menos) pesta√±as, eso depender√° de la versi√≥n de RStudio que teng√°is instalada. Yo ahora mismo tengo cuatro, pero igual la pr√≥xima versi√≥n de Rstudio puede tener 5 pesta√±as]. En seguida veremos que al interactuar con R iremos creando objetos (por ejemplo un vector o una matriz o una tabla de datos). Estos objetos estar√°n guardados en la memoria del ordenador pero los "veremos", aparecer√°n en la pesta√±a `Environment`. En la pesta√±a `History` tendremos un listado con las instrucciones de R que hayamos ejecutado previamente en nuestra actual sesi√≥n de R (por ejemplo `2 + 2`). Otro ejemplo: a veces en nuestro an√°lisis con R haremos un gr√°fico o varios, podremos ver el gr√°fico en la pesta√±a `Plots` en el panel situado abajo-derecha.


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_05_RStudio-4-paneles.png") ) 
```


La imagen de arriba es de hace unos a√±os, si te fijas el panel superior-derecha tiene solo 2 pesta√±as. En 2020 sali√≥ la versi√≥n 1.3 de RStudio, en la que en el panel superior-derecha, en lugar de haber 2 pesta√±as, hay 4, una de ellas, llamada "Tutorials", permite ejecutar tutoriales para aprender R dentro de RStudio.

<br>


## 3. Forma de trabajar con R y RStudio

Ya hemos dejado claro que vamos a usar RStudio para interactuar con R. Ok, pero hay distintas formas de trabajar, o distintos "workflows".


Cuando hagas un an√°lisis estad√≠stico complejo, por ejemplo para tu TFG, o para el trabajo final de este curso, lo normal es que para realizar el proyecto no sea suficiente con un √∫nico script; lo habitual es que cada proyecto necesite de varios inputs (datos, im√°genes, scripts etc...). En estos casos, utilizaremos un **Rproject** para cada proyecto. 

En seguida veremos como podemos crear un Rproject, y explicaremos sus ventajas, pero de momento puedes pensar que un Rproject no es m√°s que una carpeta dedicada en exclusiva a tu proyecto, una carpeta creada para almacenar todo lo relacionado con tu proyecto.

¬øPor qu√© utilizaremos **Rprojects**? Las razones son varias, pero como casi siempre quien mejor lo explica es [Jenny Bryan](https://twitter.com/jennybryan?lang=es), por ejemplo [aqu√≠](https://whattheyforgot.org/project-oriented-workflow.html).

Voy a intentar resumir yo lo que nos aconseja Jenny:

- es beneficioso poner todos los archivos (datos, scripts, im√°genes, etc...) necesarios para un an√°lisis en una √∫nica carpeta dedicada en exclusiva a ese an√°lisis o proyecto.  

- en la carpeta del proyecto es √∫til utilizar subcarpetas, por ejemplo una carpeta para datos, otra para im√°genes, etc...  

- los nombres de los archivos y las carpetas tambi√©n son importantes. Hay que intentar que los nombres de los archivos sean explicativos de lo que hace o contiene el archivo. Los nombres de los ficheros han de ser legibles por las personas, pero tambi√©n por las m√°quinas. Jenny lo explica [aqu√≠](https://speakerdeck.com/jennybc/how-to-name-files). Por favor, no dej√©is espacios en blanco en los nombres de los ficheros, si quer√©is separar palabras usad `-` y/o `_`. No us√©is espacios en blanco!!!

- una de las caracter√≠sticas m√°s interesantes de un Rproject es que el directorio de trabajo del proyecto es la propia carpeta del proyecto^[S√≠, s√© que si parece un s√≥lo un trabalenguas, pero es muy importante que esto lo acabes entendiendo. Cuando lo entiendas, y seguro que lo haces pronto, ver√°s que en realidad es muy f√°cil.]. Repito, en un Rproject, el directorio de trabajo es la propia carpeta del Rproject, y as√≠ podemos trabajar con **rutas** o paths **relativas**, lo que tiene la ventaja de que las rutas relativas funcionar√°n en cualquier ordenador^[esto lo conseguiremos trabajando con Rprojects y con el paquete `here`. Lo veremos pronto].

<br>

Trato de explicarlo un poco m√°s: cuando trabajemos en un proyecto, generalmente, tendremos que cargar unos datos. Por ejemplo, imagina que los datos que vas a usar est√°n en el fichero "mis_datos.xlsx", as√≠ que tendr√°s que decirle a R donde est√°n los datos. Tendr√°s que darle la ruta o path hasta el archivo de datos. Normal!!

Pero como vamos a trabajar con proyectos, los datos estar√°n dentro de la carpeta de mi proyecto, quiz√°s en una subcarpeta llamada "datos". Es posible que la ruta real o absoluta a mis datos sea la siguiente: `C:/Users/perezp/my_proyecto/datos/mis_datos.xlsx`, pero como trabajamos con proyectos, nuestro directorio de trabajo es la propia carpeta del proyecto, as√≠ que solo tendremos que usar una ruta relativa, solo tendremos que poner `./datos/mis_datos.xls`.

La ventaja de esto no es solamente que ahorramos tiempo escribiendo los nombres de las rutas, que tambi√©n, la principal ventaja consiste en que, si por ejemplo, queremos compartir nuestro an√°lisis con un colaborador, le daremos nuestra carpeta con todo el proyecto y los scripts **seguir√°n funcionando en SU ordenador** independientemente de donde ponga √©l la carpeta del proyecto que le hemos dejado. 

La raz√≥n obviamente es que en nuestro proyecto hemos usado **rutas relativas**. Las rutas relativas, toman como referencia, empiezan desde el directorio de trabajo, y en un `Rproject` la carpeta de trabajo es siempre la propia carpeta del proyecto.

Para alguno de vosotros esto os parecer√° complicado, pero ya ver√©is, en clase, que una vez lo entiendes, es muy-muy sencillo. Os habituareis enseguida a usar proyectos y rutas relativas.   
    

Como dice Jenny:  
    
> These habits guarantee that the project can be moved around on your computer or onto other computers and will still ‚Äújust work‚Äù. 

<br>

Para acabar esta secci√≥n, no puedo resistirme a citar otra vez a Jennyfer Bryan:

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">File organization and naming are powerful weapons against chaos by <a href="https://twitter.com/JennyBryan?ref_src=twsrc%5Etfw">@JennyBryan</a> <a href="https://twitter.com/hashtag/Mozfest?src=hash&amp;ref_src=twsrc%5Etfw">#Mozfest</a> <a href="https://twitter.com/hashtag/MozCookie?src=hash&amp;ref_src=twsrc%5Etfw">#MozCookie</a> <a href="https://twitter.com/hashtag/FortuneCookie?src=hash&amp;ref_src=twsrc%5Etfw">#FortuneCookie</a> <a href="https://t.co/W08ugLLrSa">pic.twitter.com/W08ugLLrSa</a></p>&mdash; David Guarch üññ üéóÔ∏è (@DGuarch) <a href="https://twitter.com/DGuarch/status/663049353007931392?ref_src=twsrc%5Etfw">November 7, 2015</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 

<br><br>

### Creando un Rproject

Bien, ya nos has dicho que trabajaremos con Rproject, vale, pero ¬øc√≥mo se crea un Rproject?

Simplemente has de abrir RStudio y seguir est√° ruta de men√∫s: `File > New Project...` y se abrir√° una ventana donde tendr√°s que seleccionar `New Project`. Entonces, se abrir√° otra ventana y tendr√°s que seleccionar `New Directory`. Se abrir√° otra ventana con dos cajas de texto, una, la de abajo, estar√° escrita la ruta donde se va a crear nuestra carpeta o proyecto y la caja de arriba estar√° vac√≠a y has de poner all√≠ el nombre que quieres que tenga tu proyecto. Como puedes ver en las im√°genes de abajo, yo he llamado al proyecto "my_primer_project". 


```{r, echo = FALSE, out.width = "75%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_08_crear-Rproject-1.png") ) 
knitr::include_graphics(here::here("imagenes", "tt_02_img_08_crear-Rproject-2.png") ) 
knitr::include_graphics(here::here("imagenes", "tt_02_img_08_crear-Rproject-3.png") ) 
```




```{r, echo = FALSE, out.width = "75%"}
knitr::include_graphics(here::here("imagenes", "tt_02_img_08_crear-Rproject-4.png") ) 
knitr::include_graphics(here::here("imagenes", "tt_02_img_08_crear-Rproject-5.png") ) 
```


Una vez hagas todo esto, RStudio crear√° una carpeta nueva en tu ordenador que ser√° nuestra carpeta para el proyecto. En mi caso la carpeta estar√° en "C:/Users/perezp/Desktop/my_primer_proyecto". Es una carpeta normal con un archivo dentro con un icono azulito y que tendr√° por nombre "my_primer_proyecto.Rproj"; es un fichero de texto con extensi√≥n **.Rproj**. Ya hablaremos de √©l. Adem√°s de crear una carpeta en nuestro ordenador, RStudio habr√° iniciado una nueva sesi√≥n de R con nuestro proyecto y ver√°s algo como esto: 



```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_09_my_Rproject.png") ) 
```


Sencillamente tenemos R y RStudio listos para trabajar; es decir, para ejecutar instrucciones en la consola o para crear nuestros scripts. Eso s√≠, los scripts que creemos ahora, se crear√°n directamente en la carpeta del proyecto. Ya parlarem m√®s de c√≥mo interactuar con los Rprojects en clase.


Podemos pensar que un Rproject no es m√°s que una carpeta en nuestro ordenador. De hecho puedes buscar la carpeta de tu proyecto en tu ordenador y manipularla como haces con cualquier carpeta de tu ordenador; es decir, puedes abrirla, moverla, cambiarle el nombre, crear subcarpetas, crear archivos, borrar archivos o borrar toda la carpeta. **Insisto**, para tu sistema operativo es una carpeta como cualquier otra. De momento esa carpeta solo contiene un archivo de texto con extensi√≥n **.Rproj**, poco a poco la iremos llenando con los archivos de nuestro proyecto (datos, scripts, etc ...)


La carpeta del proyecto es una carpeta normal para tu sistema operativo, pero no es una carpeta normal para RStudio. Si vas a la carpeta de tu proyecto y pinchas en el archivo "my_primer_proyecto.Proj" se abrir√° RStudio, y RStudio reconocer√° esa carpeta como un proyecto; es decir, entre otras cosas fijar√° el directorio de trabajo a la propia carpeta del proyecto y podremos usar rutas relativas. 



```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_09_my_Rproject-2.png") ) 
```

**Acu√©rdate siempre de lanzar un proyecto pinchando en el archivo con extensi√≥n ".Rproj" !!!!** Hay otras formas de lanzar el proyecto pero de momento usaremos esta.


### ¬øPor qu√© usamos Rprojects?

Gestionar tus an√°lisis utilizando Rprojects tiene ventajas:

1) puedes gestionar varios proyectos a la vez, cada uno con su espacio de trabajo (√≥ environment), pero sobre todo,

2) facilita el compartir tus an√°lisis; es decir, favorece la investigaci√≥n reproducible.


Podemos pensar que un Rproject es una carpeta, pero es m√°s que eso: cada Rproject tiene su propio directorio de trabajo, espacio de trabajo (environment), historial de instrucciones; adem√°s, permite crear una estructura de carpetas donde guardar los documentos asociados al proyecto en carpetas separadas (p.ej: una carpeta para datos, otra para im√°genes, ...).

Cuando abres un Rproject en RStudio (pinchando en el fichero `.Rproj`) ocurre lo siguiente:  

   - Comienza un nuevo proceso de R (esto tambi√©n es importante para la investigaci√≥n reproducible)
   
   - El directorio de trabajo se fija a la carpeta que contiene el Rproject, con lo que podemos usar rutas relativas (relativas a la carpeta del proyecto)
   
   
   <br>
   
   
#### Cuidado con los paths!!

- Un gran inconveniente para conseguir informes (plenamente) reproducibles son los paths o rutas de ficheros. Si un programa necesita llamar a un fichero de datos (por ejemplo para cargar unos datos), tendr√°s que especificar la ruta y si alguien quiere ejecutar tus *scripts* en **su** ordenador deber√° cambiar la ruta.

- Trabajar con Rprojects permite solventar este problema, ya que el directorio de trabajo del Rproject coincide con la carpeta donde est√° alojado el Rproject y esto permite (ya lo veremos en el pr√≥ximo tutorial) trabajar con rutas (o paths) relativas en lugar de absolutas. (!!)

<br>

- En palabras de [Jenny Bryan](https://github.com/jennybc) una de mis he**R**o√≠nas y destacada miembro de la comunidad R, si empiezas tus scripts con `setwd()`, significa que est√°s usando rutas absolutas, puedes hacerlo, pero Jenny nos aconseja que ...  **PLEASE STOP DOING THAT !!** Ademas Jenny nos lo explica:

  > This makes your script very fragile, hard-wired to exactly one time and place. As soon as you rename or move directories, it breaks. Or maybe you get a new computer? Or maybe someone else needs to run your code? 

- Para Jenny la soluci√≥n es  usar el pkg `here`, y tiene raz√≥n, pero nosotros (de momento) s√≥lo usaremos Rprojects (suficiente!!). `r emo::ji("thinking")` . Bueno no, eso era en el curso para profesores, a vosotros s√≠ que os veo capacitados para aprender como usar `here::here()`. `r emo::ji("devil")`  `r emo::ji("lol")` .  Lo veremos. El que tenga curiosidad puede leer en [este post](https://malco.io/2018/11/05/why-should-i-use-the-here-package-when-i-m-already-using-projects/) porqu√©, a pesar de trabajar con Rprojects, tiene ventajas especificar las rutas con el paquete `here`.



<br>

   
## 4. RMarkdown (archivos **.Rmd**)

S√≠, ya sabemos que trabajaremos con Rprojects. OK, pero tambi√©n dije que muchas veces en lugar de dar las instrucciones a R por medio de scripts o ficheros `.R`, trabajar√≠amos con ficheros `Rmarkdown`. Estos ficheros Rmarkdown tienen extensi√≥n `.Rmd`.

- Los documentos **RMarkdown** son ficheros con extensi√≥n **`.Rmd`**.

- Si acabas utilizando R para hacer an√°lisis estad√≠sticos, los ficheros `.Rmd` te permitir√°n escribir muy-muy f√°cilmente informes, tutoriales y transparencias para presentaciones.  

- Estos ficheros .Rmd son (plenamente) reproducibles.

- Lo veremos, pero en esos ficheros .Rmd se mezclan trozos de  texto escritos en Markdown (narratives) y trozos con c√≥digo R (chunks) para hacer an√°lisis estad√≠sticos.

- Estos ficheros se procesan con un paquete de R llamado `knitr` desarrollado por [Yihui Xie](https://yihui.name/knitr/) ... y salen unos informes o transparencias fant√°sticas ... en una gran variedad de formatos.

- Con RStudio es muy f√°cil: solo hay que usar los men√∫s desplegables de RStudio para crear un documento Rmarkdown, escribir lo que quieres contar y darle al bot√≥n Knitr y `knitr` tejer√° el documento y lo transformar√° a .... pdf, word, html ...


<br>


Tardaremos unas 3-4 clases en explicar en detalle qu√© son y para que sirven los ficheros Rmarkdown, pero vamos ya a crear uno. Para ello tienes que seguir en RStudio esta ruta de men√∫s: `File > New File > R Markdown...`. Visualmente:


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-1.png") ) 
```



Se abrir√° una ventana. De momento no cambies nada, s√≥lo pincha en `OK`. 


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-2.png") ) 
```

Ver√°s que se ha abierto una pesta√±a en el editor de RStudio (arriba-izquierda), con lo que parece que son muchas lineas de c√≥digo R. S√≠, ha creado para nosotros un archivo `.Rmd` y ha puesto unas lineas de c√≥digo que nos sirven como ejemplo de c√≥mo se escribe en Rmarkdown. Ya lo veremos. Visualmente:


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-3.png") ) 
```


Estos ficheros `.Rmd` se ejecutan de otra forma. Tienes que pinchar en el icono que pone `Knit`. Visualmente: 


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-4.png") ) 
```


Aparecer√° una ventana pidi√©ndote que le pongas un nombre al fichero `.Rmd`. Como puedes ver abajo yo le puse el nombre "para_borrar", pero puedes poner el nombre que quieras.


```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-5.png") ) 
```


Una vez le hayas puesto nombre. R ejecutar√° todas las instrucciones que hay en el fichero .Rmd y generar√° un nuevo documento que podr√°s ver en el panel de abajo-derecha. Adem√°s si pinchas en el icono que aparece marcado con una mano( panel abajo-derecha) en la imagen de abajo podr√°s verlo en tu navegador. Visualmente:



```{r, echo = FALSE}
knitr::include_graphics(here::here("imagenes", "tt_02_img_10_Rmd-6.png") ) 
```

Durante el curso vamos  a trabajar mucho con ficheros .Rmd, as√≠ que tendremos que explicarlos/entenderlos bien. Pero ser√° otro d√≠a/lesson. Si os apetece pod√©is ver [este video](https://www.youtube.com/watch?v=lNWVQ2oxNho) donde se explica las ventajas de trabajar en con ficheros Rmarkdow. Igual ma√±ana lo pregunto.



<br><br>


Para finalizar un consejo: estamos empezando, as√≠ que PATIENCE!!! cuesta un poco aprender/empezar con R. Adem√°s todo el mundo comete errores, pero la mayor√≠a de los errores son "tontos". Eso s√≠, ten√©is que entender las ideas b√°sicas: script, .R, .Rmd, Rproject, rutas relativas etc... si no lo entiendes, no lo dejes pasar, preg√∫ntalo en clase, seguro que m√°s de uno te lo agradece o podemos arreglarlo en tutor√≠as, pero no lo dejes pasar.


```{r, echo = FALSE}
tweetrmd::tweet_embed("https://twitter.com/allison_horst/status/1213275783675822080",  align = "center", dnt = TRUE, plain = TRUE, maxwidth = 700)
```

